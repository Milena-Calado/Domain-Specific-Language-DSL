<!DOCTYPE html>
<html>

<head>
    <meta name="description" content="KiDSL">    
    <meta name="author" content="Milena Calado">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="static/css/materialize.min.css" media="screen,projection" />
    <!-- <link type="text/css" rel="stylesheet" href="static/css/robotics.css" media="screen,projection" /> -->
    <!-- Import js-beautify.js -->
    <!--Import jQuery library-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!--Let browser know website is optimized for mobile-->
    <title>KiDSL</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!--blocklys-->
    <script src="static/src/blockly_compressed.js"></script>
    <script src="static/src/blocks_compressed.js"></script>
    <script src="static/src/javascript_compressed.js"></script>
    <script src="static/src/python_compressed.js"></script>
    <script src="static/blockly/msg/js/en.js"></script>
    <script src="static/src/tudo.js"></script>
    <script src="static/src/blocos_up.js"></script>   
    <!-- <script src="static/blockly/wo.js"></script>     -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>
</head>



<style>
    .clearfix {
        overflow: scroll;
    }
    .fixed-image {
            position: fixed;
            top: 10px; /* Ajuste a posição vertical conforme necessário */
            left: 8px; /* Ajuste a posição horizontal conforme necessário */
        }
    .nav-icons {
      margin-right: 10px; /* Ajuste o valor conforme necessário */
  }
</style>

<body>
  <nav class="black darken-2">
    <div class="nav-wrapper" style="width: 90%; margin: 0 auto;">
          <a href="#!" class="brand-logo" style="margin-left: 5%; margin-top:0%">
              <img alt="logo" src="static/img/KiDSL_logo.png" class="fixed-image" style="width: 120px;">
              <!-- <img alt="logo" src="static/img/KiDLS__1_-removebg-preview.png" style="width: 100px; height: auto; margin-top: 10px;"> -->
          </a>
          <ul class="right hide-on-med-and-down">      
            <li class="nav-icons"><a href="#" onclick="runCode()">Execute</a></li>                     
            <li class="nav-icons"><a href="#" onclick="pararExecucao()">Stop</a></li>

            <!-- <li class="nav-icons"><a href="#" onclick="runCode()"><i class="material-icons">play_circle_outline</i></a></li>            -->
            <!-- <li class="nav-icons"><a href="#"><i class="material-icons">stop </i></a></li>           -->
            
          </ul>
      </div>
  </nav>

  <div class="col s12" style="min-width: 680px; min-height: 400px; height: 100vh;">
    <div class="row" style="height: 100%;">
        <div class="col s8" style="height: 100%;">
            <div id="blocklyDiv" style="height: 80%; width: 100%; border: 5px solid #E5E7E9;">
               <!-- Botão para executar o código gerado -->
    
            </div>
        </div>
        <div class="col s4" style="height: 100%;">
            <div id="codigogerado" style="font-family: 'Courier New', Courier, monospace; height: 80%; width: 100%; padding-left: 2%; background-color: #FFFFFF; color: #000; border: 5px solid #E5E7E9;" class="clearfix">
              
            </div>
        </div>
    </div>
</div>


    <xml id="toolbox" style="display: none">
      <category name="Logic" colour="#5b80a5">
        <block type="controls_if"></block>
        <block type="logic_compare">
          <field name="OP">EQ</field>
        </block>
        <block type="logic_operation">
          <field name="OP">AND</field>
        </block>
        <block type="logic_negate"></block>
        <block type="logic_boolean">
          <field name="BOOL">TRUE</field>
        </block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" colour="#5ba55b">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="controls_whileUntil">
          <field name="MODE">WHILE</field>
        </block>
        <block type="controls_for">
          <field name="VAR" id="MeUX?x_{$I48s`(8=5lK">i</field>
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach">
          <field name="VAR" id="8;`xQ0eD*=@H7U]l^.*Y">j</field>
        </block>
        <block type="controls_flow_statements">
          <field name="FLOW">BREAK</field>
        </block>
      </category>
      <category name="Math" colour="#5b67a5">
        <block type="math_number">
          <field name="NUM">0</field>
        </block>
        <block type="math_arithmetic">
          <field name="OP">ADD</field>
          <value name="A">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="math_single">
          <field name="OP">ROOT</field>
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">9</field>
            </shadow>
          </value>
        </block>
        <block type="math_trig">
          <field name="OP">SIN</field>
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">45</field>
            </shadow>
          </value>
        </block>
        <block type="math_constant">
          <field name="CONSTANT">PI</field>
        </block>
        <block type="math_number_property">
          <mutation divisor_input="false"></mutation>
          <field name="PROPERTY">EVEN</field>
          <value name="NUMBER_TO_CHECK">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="math_round">
          <field name="OP">ROUND</field>
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">3.1</field>
            </shadow>
          </value>
        </block>
        <block type="math_on_list">
          <mutation op="SUM"></mutation>
          <field name="OP">SUM</field>
        </block>
        <block type="math_modulo">
          <value name="DIVIDEND">
            <shadow type="math_number">
              <field name="NUM">64</field>
            </shadow>
          </value>
          <value name="DIVISOR">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="math_constrain">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="LOW">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="HIGH">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_float"></block>
      </category>
      <category name="Text" colour="#5ba58c">
        <block type="text">
          <field name="TEXT"></field>
        </block>
        <block type="text_join">
          <mutation items="2"></mutation>
        </block>
        <block type="text_append">
          <field name="VAR" id="x{1rCm(xn[1-m]vu6WAf">item</field>
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_length">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_isEmpty">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_indexOf">
          <field name="END">FIRST</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="UJe2}D}NV]!JARM4[.fP">text</field>
            </block>
          </value>
          <value name="FIND">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_charAt">
          <mutation at="true"></mutation>
          <field name="WHERE">FROM_START</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="UJe2}D}NV]!JARM4[.fP">text</field>
            </block>
          </value>
        </block>
        <block type="text_getSubstring">
          <mutation at1="true" at2="true"></mutation>
          <field name="WHERE1">FROM_START</field>
          <field name="WHERE2">FROM_START</field>
          <value name="STRING">
            <block type="variables_get">
              <field name="VAR" id="UJe2}D}NV]!JARM4[.fP">text</field>
            </block>
          </value>
        </block>
        <block type="text_changeCase">
          <field name="CASE">UPPERCASE</field>
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_trim">
          <field name="MODE">BOTH</field>
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_prompt_ext">
          <mutation type="TEXT"></mutation>
          <field name="TYPE">TEXT</field>
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Lists" colour="#745ba5">
        <block type="lists_create_with">
          <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with">
          <mutation items="3"></mutation>
        </block>
        <block type="lists_repeat">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">5</field>
            </shadow>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <field name="END">FIRST</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="2Y1R935~j^Ar:*3as~Pf">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <mutation statement="false" at="true"></mutation>
          <field name="MODE">GET</field>
          <field name="WHERE">FROM_START</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="2Y1R935~j^Ar:*3as~Pf">list</field>
            </block>
          </value>
        </block>
        <block type="lists_setIndex">
          <mutation at="true"></mutation>
          <field name="MODE">SET</field>
          <field name="WHERE">FROM_START</field>
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" id="2Y1R935~j^Ar:*3as~Pf">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <mutation at1="true" at2="true"></mutation>
          <field name="WHERE1">FROM_START</field>
          <field name="WHERE2">FROM_START</field>
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" id="2Y1R935~j^Ar:*3as~Pf">list</field>
            </block>
          </value>
        </block>
        <block type="lists_split">
          <mutation mode="SPLIT"></mutation>
          <field name="MODE">SPLIT</field>
          <value name="DELIM">
            <shadow type="text">
              <field name="TEXT">,</field>
            </shadow>
          </value>
        </block>
        <block type="lists_sort">
          <field name="TYPE">NUMERIC</field>
          <field name="DIRECTION">1</field>
        </block>
      </category>
      <category name="Colour" colour="#a5745b">
        <block type="colour_picker">
          <field name="COLOUR">#ff0000</field>
        </block>
        <block type="colour_random"></block>
        <block type="colour_rgb">
          <value name="RED">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
          <value name="GREEN">
            <shadow type="math_number">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="BLUE">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="colour_blend">
          <value name="COLOUR1">
            <shadow type="colour_picker">
              <field name="COLOUR">#ff0000</field>
            </shadow>
          </value>
          <value name="COLOUR2">
            <shadow type="colour_picker">
              <field name="COLOUR">#3333ff</field>
            </shadow>
          </value>
          <value name="RATIO">
            <shadow type="math_number">
              <field name="NUM">0.5</field>
            </shadow>
          </value>
        </block>
      </category>
      <sep></sep>
      <category name="Variables" colour="#a55b80" custom="VARIABLE"></category>
      <category name="Functions" colour="#995ba5" custom="PROCEDURE"></category>
      <sep></sep>
    
      <category name="Database" colour="230">
        <block type="execute_python_script">
          <value name="PATH FILE">
            <shadow type="text">
              <field name="TEXT">Path file</field>
            </shadow>
          </value>
        </block>       
        <!-- <block type="createDatabase">
        <value name="host">
          <block type="text">
            <field name="TEXT">localhost</field>
          </block>
        </value>
        <value name="user">
          <block type="text">
            <field name="TEXT">root</field>
          </block>
        </value>
        <value name="password">
          <block type="text">
            <field name="TEXT">Softex2023</field>
          </block>
        </block> -->
        <block type="mysqlConnection">
          <value name="host">
            <block type="text">
              <field name="TEXT">localhost</field>
            </block>
          </value>
          <value name="user">
            <block type="text">
              <field name="TEXT">root</field>
            </block>
          </value>
          <value name="password">
            <block type="text">
              <field name="TEXT">Softex2023</field>
            </block>
          </value>
          <value name="database">
            <block type="text">
              <field name="TEXT">farmacia</field>
            </block>
          </value>
        </block>
        <block type="create_ticket">
          <value name="medicamentos">
            <!-- Aqui você pode adicionar blocos de entrada para os medicamentos -->
          </value>
          <value name="nomePaciente">
            <!-- Aqui você pode adicionar um bloco de entrada para o nome do paciente -->
          </value>
          <value name="PoseMedicamento">
            <!-- Aqui você pode adicionar um bloco de entrada para a dose do medicamento -->
          </value>
          <value name="quantidade">
            <!-- Aqui você pode adicionar um bloco de entrada para a quantidade -->
          </value>
        </block>
        
        
        <!-- <block type="gerarTickets"></block> -->
      </category>
      <sep></sep>

      <category name="Connection" colour="500">
        <block type="connectToRobot"></block>
        <block type="disconnectFromRobot"></block>
      </category>
      
      <category name="Movements" colour="65">    
        <block type="move_to_home"></block>
        <block type="move_to_end"></block>
        <block type="moveJoints">
          <value name="joints_list">
            <block type="lists_create_with" inline="true">
              <mutation items="6"></mutation>
              <value name="ADD0">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD1">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD2">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD3">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD4">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD5">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
            </block>
          </value>
        </block>
        <block type="moveCartesian">
          <value name="pose_list">
            <block type="lists_create_with" inline="true">
              <mutation items="6"></mutation>
              <value name="ADD0">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD1">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD2">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD3">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD4">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
              <value name="ADD5">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
            </block>
          </value>
        </block>           
       
        <block type="safety">
          <value name="joints_list">
            <block type="lists_create_with" inline="true">
              <mutation items="6"></mutation>
              <value name="ADD0">
                <block type="math_number">
                  <field name="NUM">295.18951416015625</field>
                </block>
              </value>
              <value name="ADD1">
                <block type="math_number">
                  <field name="NUM">309.2252197265625</field>
                </block>
              </value>
              <value name="ADD2">
                <block type="math_number">
                  <field name="NUM">116.1842041015625</field>
                </block>
              </value>
              <value name="ADD3">
                <block type="math_number">
                  <field name="NUM">295.02618408203125</field>
                </block>
              </value>
              <value name="ADD4">
                <block type="math_number">
                  <field name="NUM">80.2393798828125</field>
                </block>
              </value>
              <value name="ADD5">
                <block type="math_number">
                  <field name="NUM">85.50155639648438</field>
                </block>
              </value>
            </block>
          </value>
        </block>

      </category>
      <category name="Medicines" colour="150">
        <block type="tigeciclina"></block>         
        <block type="fentanila"></block>            
        <block type="colistemato"></block>         
      </category>

      <category name="Gripper" colour="120">
        <block type="open_tool"></block>
        <block type="close_tool"></block>        
      </category>

      <category name="Retrieve" colour="330">      
        <block type="retrieve_tickets" ></block>
        <block type="retrieve_items" ></block>   
      </category>
      
     
    </xml>
   
    <script>
    function runCode() {
            var code = Blockly.Python.workspaceToCode(workspace);

            // Envia o código gerado para o servidor usando AJAX
            $.ajax({
                type: "POST",
                url: "/run_code",
                contentType: "application/json;charset=UTF-8",
                data: JSON.stringify({ code: code }),
                success: function (response) {
                    console.log(response);
                    // Aqui você pode lidar com a resposta do servidor, se necessário
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

      

      var mostrar = "nada aqui";
      var toolbox = document.getElementById('toolbox');

      var workspace = Blockly.inject('blocklyDiv', {
          toolbox: toolbox,
          zoom: {
              controls: true,  // Mostra os controles de zoom
              wheel: true,     // Ativa o zoom com a roda do mouse
              startScale: 1.0,
              maxScale: 3,
              minScale: 0.3,
              scaleSpeed: 1.2
          },
          trashcan: true  // Mostra a lixeira
      });

      function update(event) {
        Blockly.Python.INFINITE_LOOP_TRAP = null;
        var code = Blockly.Python.workspaceToCode(workspace);
        if (code !== "") {
            // Atualize o código gerado diretamente
            mostrar = code;
            document.getElementById("codigogerado").innerHTML = mostrar;
            cleanThanUp();
        }
    }


      function cleanThanUp() {
          var list = document.getElementById("im");
          while (list.hasChildNodes()) {
              list.removeChild(list.childNodes[0]);
          }
          updateGraph();
      }

      function updateGraph() {
          if (mostrar != "nada aqui") {
              var viz = new Viz();
              viz.renderSVGElement(mostrar)
                  .then(function(element) {
                      document.getElementById("im").appendChild(element);
                  })
                  .catch(error => {
                      // Create a new Viz instance (@see Caveats page for more info)
                      viz = new Viz();

                      // Possibly display the error
                      console.error(error);
                  });
          }
      }

workspace.addChangeListener(function(event) {
    if (event.type == Blockly.Events.MOVE) {
        update(event);
    }
});

   //     workspace.addChangeListener(update);
    </script>
    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="static/js/materialize.min.js"></script>
    <!-- <script type="text/javascript" src="static/js/bootstrap.min.js"></script>  -->
    <script type="text/javascript" src="static\Blockly\tests\jsunit\connection_db_test.js"></script>
    <!-- <script type="text/javascript" src="static/js/FileSaver.js"></script>
    <script type="text/javascript" src="static/js/prettify.js"></script>
    <script type="text/javascript" src="static/js/jquery.mousewheel.min.js"></script> -->
</body>

</html>